(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6667:(e,t,r)=>{Promise.resolve().then(r.bind(r,6768))},6768:(e,t,r)=>{"use strict";r.d(t,{default:()=>N});var s=r(5155),a=r(2115),n=r(6874),l=r.n(n);class i{generateCacheKey(e,t,r){let s=btoa(t+(r||"")).replace(/[^a-zA-Z0-9]/g,"").slice(0,16);return"".concat(e,"_").concat(s)}isExpired(e){return Date.now()-e>this.CACHE_DURATION}cleanExpired(){for(let[e,t]of(Date.now(),this.cache.entries()))this.isExpired(t.timestamp)&&this.cache.delete(e)}ensureCacheSize(){this.cache.size>this.MAX_CACHE_SIZE&&Array.from(this.cache.entries()).sort((e,t)=>e[1].timestamp-t[1].timestamp).slice(0,this.cache.size-this.MAX_CACHE_SIZE+10).forEach(e=>{let[t]=e;return this.cache.delete(t)})}getSuggestions(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.cleanExpired();let s=this.generateCacheKey(e,t,r),a=this.cache.get(s);return a&&!this.isExpired(a.timestamp)?a.suggestions:null}setSuggestions(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3?arguments[3]:void 0;this.cleanExpired(),this.ensureCacheSize();let a=this.generateCacheKey(e,t,r);this.cache.set(a,{taskId:e,taskContent:t,taskDescription:r,suggestions:s,timestamp:Date.now()})}async generateSuggestions(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,n=this.getSuggestions(e,t,r);if(n)return n;try{let n=await fetch("/api/llm/generate-project-suggestions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskContent:t,taskDescription:r,projectHierarchy:s,currentProjectId:a})});if(!n.ok)return console.error("Failed to generate suggestions:",n.statusText),[];{let s=(await n.json()).suggestions||[];return this.setSuggestions(e,t,r,s),s}}catch(e){return console.error("Error generating suggestions:",e),[]}}async prefetchSuggestions(e,t){let r=e.map(e=>this.generateSuggestions(e.id,e.content,e.description||"",t,e.projectId));try{await Promise.all(r)}catch(e){console.error("Error prefetching suggestions:",e)}}invalidateTask(e){Array.from(this.cache.keys()).filter(t=>{var r;return(null==(r=this.cache.get(t))?void 0:r.taskId)===e}).forEach(e=>this.cache.delete(e))}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,entries:Array.from(this.cache.values()).map(e=>({taskId:e.taskId,content:e.taskContent.slice(0,30)+"...",suggestionsCount:e.suggestions.length,age:Math.round((Date.now()-e.timestamp)/1e3)}))}}constructor(){this.cache=new Map,this.CACHE_DURATION=3e5,this.MAX_CACHE_SIZE=50}}let o=new i;function c(e){let{task:t,projects:r,labels:n,onContentChange:l,onDescriptionChange:i,onProjectClick:o,onPriorityClick:c,onLabelAdd:d,onLabelRemove:u,onScheduledClick:g,onDeadlineClick:m}=e,[x,h]=(0,a.useState)(t.content),[b,f]=(0,a.useState)(t.description||""),[p,y]=(0,a.useState)(null),k=(0,a.useRef)(null),j=(0,a.useRef)(null);(0,a.useEffect)(()=>{h(t.content),f(t.description||"")},[t.id,t.content,t.description]);let v=(0,a.useCallback)((e,r)=>{p&&clearTimeout(p),y(setTimeout(()=>{"content"===e&&r!==t.content&&l?l(r):"description"===e&&r!==(t.description||"")&&i&&i(r)},1e3))},[p,t.content,t.description,l,i]);(0,a.useEffect)(()=>{let e=e=>{e&&(e.style.height="auto",e.style.height="".concat(e.scrollHeight,"px"))};e(k.current),e(j.current)},[x,b]);let w=e=>{try{let t=new Date(e);if(isNaN(t.getTime()))return"Invalid date";return t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch(t){return console.error("Error formatting date:",t,"Input:",e),"Invalid date"}},N=e=>({berry_red:"#b8256f",red:"#db4035",orange:"#ff9933",yellow:"#fad000",olive_green:"#afb83b",lime_green:"#7ecc49",green:"#299438",mint_green:"#6accbc",teal:"#158fad",sky_blue:"#14aaf5",light_blue:"#96c3eb",blue:"#4073ff",grape:"#884dff",violet:"#af38eb",lavender:"#eb96eb",magenta:"#e05194",salmon:"#ff8d85",charcoal:"#808080",grey:"#b8b8b8",taupe:"#ccac93"})[e]||"#299fe6",T=e=>5-e;return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 task-card-enter",children:[(0,s.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center flex-wrap gap-2 mb-2",children:[(0,s.jsxs)("button",{onClick:c,className:"px-2 py-1 text-xs font-medium rounded-md border transition-colors hover:opacity-80 cursor-pointer ".concat((e=>{switch(T(e)){case 1:return"text-red-600 bg-red-50 border-red-200";case 2:return"text-orange-600 bg-orange-50 border-orange-200";case 3:return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})(t.priority)),title:"Click to change priority",children:["P",T(t.priority)," • ",(e=>{switch(T(e)){case 1:return"Urgent";case 2:return"High";case 3:return"Medium";default:return"Normal"}})(t.priority)]}),(0,s.jsx)("button",{onClick:o,className:"inline-flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded text-xs transition-colors cursor-pointer",title:"Click to change project",children:(()=>{let e=r.find(e=>e.id===t.projectId),a=e?N(e.color):"#299fe6";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:a}}),(0,s.jsx)("span",{className:"text-gray-700",children:(null==e?void 0:e.name)||"Unknown Project"})]})})()}),t.due?(0,s.jsxs)("button",{onClick:g,className:"inline-flex items-center space-x-2 bg-blue-50 hover:bg-blue-100 px-2 py-1 rounded text-xs transition-colors cursor-pointer border border-blue-200",title:"Click to change scheduled date",children:[(0,s.jsx)("svg",{className:"w-3 h-3 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,s.jsx)("span",{className:"text-blue-700",children:t.due.string||w(t.due.date)})]}):(0,s.jsxs)("button",{onClick:g,className:"inline-flex items-center space-x-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 px-2 py-1 rounded text-xs transition-colors",title:"Add scheduled date",children:[(0,s.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,s.jsx)("span",{children:"Schedule"})]}),t.deadline?(0,s.jsxs)("button",{onClick:m,className:"inline-flex items-center space-x-2 bg-red-50 hover:bg-red-100 px-2 py-1 rounded text-xs transition-colors cursor-pointer border border-red-200",title:"Click to change deadline",children:[(0,s.jsx)("svg",{className:"w-3 h-3 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("span",{className:"text-red-700",children:t.deadline.string||w(t.deadline.date)})]}):(0,s.jsxs)("button",{onClick:m,className:"inline-flex items-center space-x-2 text-gray-400 hover:text-red-600 hover:bg-red-50 px-2 py-1 rounded text-xs transition-colors",title:"Add deadline",children:[(0,s.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("span",{children:"Deadline"})]})]}),(0,s.jsx)("textarea",{ref:k,value:x,onChange:e=>{let t=e.target.value;h(t),v("content",t)},className:"w-full text-xl font-semibold text-gray-900 leading-tight bg-transparent hover:bg-gray-50 rounded-md px-2 py-1 focus:outline-none focus:bg-white focus:ring-2 focus:ring-todoist-blue resize-none transition-all overflow-hidden",style:{minHeight:"2rem"},placeholder:"Task name..."})]})}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("textarea",{ref:j,value:b,onChange:e=>{let t=e.target.value;f(t),v("description",t)},className:"w-full text-gray-600 bg-gray-50 hover:bg-gray-100 focus:bg-white rounded-md p-3 text-sm leading-relaxed focus:outline-none focus:ring-2 focus:ring-todoist-blue resize-none transition-all overflow-hidden",placeholder:"Add a description...",style:{minHeight:"3rem"}})}),(0,s.jsx)("div",{className:"space-y-3 mb-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Labels:"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[t.labels.map(e=>{let t=n.find(t=>t.name===e),r=t?N(t.color):"#299fe6";return(0,s.jsx)("div",{className:"text-xs px-2 py-1 rounded-full flex items-center group relative transition-all",style:{backgroundColor:"".concat(r,"20"),color:r},children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full flex-shrink-0 mr-1 group-hover:hidden",style:{backgroundColor:r}}),(0,s.jsx)("button",{onClick:()=>null==u?void 0:u(e),className:"w-2 h-2 mr-1 rounded-full items-center justify-center hidden group-hover:flex hover:scale-125 transition-transform",title:"Remove label",children:(0,s.jsx)("span",{className:"text-xs font-bold leading-none",children:"\xd7"})}),(0,s.jsx)("span",{children:e})]})},e)}),(0,s.jsx)("button",{onClick:d,className:"text-xs px-2 py-1 rounded-full flex items-center transition-colors bg-gray-100 text-gray-600 hover:bg-gray-200",title:"Add labels",children:(0,s.jsx)("span",{className:"font-medium",children:"+ Add Label"})})]})]})}),(0,s.jsx)("div",{className:"pt-4 border-t border-gray-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsxs)("span",{children:["Created: ",w(t.createdAt)]}),(0,s.jsxs)("span",{children:["ID: ",t.id]})]})})]})}function d(e){let{task:t,projects:r,labels:n,suggestions:l,onAutoSave:i,onNext:o,onPrevious:c,canGoNext:d,canGoPrevious:u}=e,[g,m]=(0,a.useState)({content:t.content,description:t.description||"",projectId:t.projectId,labels:[...t.labels],dueString:""}),[x,h]=(0,a.useState)(new Set(t.labels)),b=(0,a.useRef)(null),f=(0,a.useRef)(null),p=(0,a.useCallback)(e=>{b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{let t={...e,labels:Array.from(x)};JSON.stringify(t)!==JSON.stringify(f.current)&&(console.log("Auto-saving changes:",t),i(t),f.current=t)},2e3)},[i,x]);return(0,a.useEffect)(()=>{let e={content:t.content,description:t.description||"",projectId:t.projectId,labels:[...t.labels],dueString:""};m(e),h(new Set(t.labels)),f.current={...e,labels:t.labels},b.current&&clearTimeout(b.current)},[t.id,t.content,t.description,t.projectId,t.labels]),(0,a.useEffect)(()=>{p(g)},[g,p]),(0,a.useEffect)(()=>()=>{b.current&&clearTimeout(b.current)},[]),l.filter(e=>"project"===e.type),l.filter(e=>"label"===e.type),l.filter(e=>"rewrite"===e.type),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:c,disabled:!u,className:"flex-1 py-3 px-4 rounded-md font-medium transition-colors focus:ring-2 focus:ring-offset-2 ".concat(u?"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 focus:ring-gray-500":"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed"),children:"← Previous"}),(0,s.jsx)("button",{type:"button",onClick:o,disabled:!d,className:"flex-1 py-3 px-4 rounded-md font-medium transition-colors focus:ring-2 focus:ring-offset-2 ".concat(d?"bg-todoist-blue text-white hover:bg-blue-600 focus:ring-todoist-blue":"bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed"),children:"Next Task →"})]})})}function u(e){let{onClose:t}=e;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Keyboard Shortcuts"}),(0,s.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 rounded",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"space-y-4",children:[{category:"Navigation",items:[{key:["j","Enter","→"],description:"Go to next task"},{key:["k","←"],description:"Go to previous task"},{key:"?",description:"Show/hide keyboard shortcuts"},{key:["Esc","`"],description:"Close any open dialog"}]},{category:"Task Management",items:[{key:"p",description:"Change task priority"},{key:"#",description:"Move to different project"},{key:"@",description:"Add or remove labels"},{key:"s",description:"Schedule when to work on task"},{key:"d",description:"Set task deadline"},{key:"e",description:"Archive task (removes from inbox)"},{key:"c",description:"Mark task as complete"}]},{category:"Within Dialogs",items:[{key:["1","2","3","4"],description:"Set priority directly (P1-P4)"},{key:["↑","↓"],description:"Navigate through options"},{key:"Enter",description:"Select highlighted option"},{key:"Type",description:"Filter options or enter custom date"}]}].map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:e.category}),(0,s.jsx)("div",{className:"space-y-2",children:e.items.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:e.description}),(0,s.jsx)("div",{className:"flex items-center gap-1",children:Array.isArray(e.key)?e.key.map((t,r)=>(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"kbd",children:t}),r<e.key.length-1&&(0,s.jsx)("span",{className:"mx-1 text-gray-400",children:"/"})]},r)):(0,s.jsx)("span",{className:"kbd",children:e.key})})]},t))})]},t))}),(0,s.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Press ",(0,s.jsx)("span",{className:"kbd",children:"?"})," anytime to toggle this help"]})})]})})}function g(e){let{current:t,total:r,progress:a}=e;return(0,s.jsxs)("div",{className:"py-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Progress: ",t," of ",r]}),(0,s.jsxs)("span",{className:"text-sm text-gray-600",children:[Math.round(a),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-todoist-blue h-2 rounded-full transition-all duration-300 ease-out",style:{width:"".concat(a,"%")}})})]})}function m(e){let{projects:t,selectedProjectId:r,onProjectChange:n,placeholder:l="Select project...",includeInbox:i=!0,className:o=""}=e,[c,d]=(0,a.useState)(!1),[u,g]=(0,a.useState)(""),m=(0,a.useRef)(null),x=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&(d(!1),g(""))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.useEffect)(()=>{c&&x.current&&x.current.focus()},[c]);let h=e=>({berry_red:"#b8256f",red:"#db4035",orange:"#ff9933",yellow:"#fad000",olive_green:"#afb83b",lime_green:"#7ecc49",green:"#299438",mint_green:"#6accbc",teal:"#158fad",sky_blue:"#14aaf5",light_blue:"#96c3eb",blue:"#4073ff",grape:"#884dff",violet:"#af38eb",lavender:"#eb96eb",magenta:"#e05194",salmon:"#ff8d85",charcoal:"#808080",grey:"#b8b8b8",taupe:"#ccac93"})[e]||"#299fe6",b=(()=>{let e=t.filter(e=>!e.parentId&&!e.isInboxProject),r=t.filter(e=>e.parentId&&!e.isInboxProject),s=[];if(i){let e=t.find(e=>e.isInboxProject);s.push({id:(null==e?void 0:e.id)||"inbox",name:"Inbox",color:e?h(e.color):"#299fe6",indent:0})}let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;s.push({id:e.id,name:e.name,color:h(e.color),indent:t}),r.filter(t=>t.parentId===e.id).forEach(e=>a(e,t+1))};return e.forEach(e=>a(e)),s})(),f=b.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())),p=b.find(e=>e.id===r),y=(e,t)=>{t.preventDefault(),t.stopPropagation(),n(e),d(!1),g("")};return(0,s.jsxs)("div",{className:"relative ".concat(o),ref:m,children:[(0,s.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),d(!c)},className:"w-full flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-md transition-colors",children:[(0,s.jsx)("div",{className:"flex items-center space-x-3",children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:p.color}}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:p.name})]}):(0,s.jsx)("span",{className:"text-gray-500",children:l})}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform ".concat(c?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),c&&(0,s.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-50 dropdown-open",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[(0,s.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,s.jsx)("input",{ref:x,type:"text",placeholder:"Search projects...",value:u,onChange:e=>{e.preventDefault(),e.stopPropagation(),g(e.target.value)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-todoist-blue focus:border-transparent text-sm"})}),(0,s.jsx)("div",{className:"max-h-64 overflow-y-auto",children:f.length>0?f.map(e=>(0,s.jsxs)("button",{type:"button",onClick:t=>y(e.id,t),className:"w-full flex items-center space-x-3 p-3 text-left hover:bg-gray-50 transition-colors ".concat(r===e.id?"bg-blue-50 text-blue-900":"text-gray-900"),style:{paddingLeft:"".concat(12+20*e.indent,"px")},children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:e.color}}),(0,s.jsx)("span",{className:"font-medium flex-1",children:e.name}),r===e.id&&(0,s.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e.id)):(0,s.jsx)("div",{className:"p-3 text-center text-gray-500 text-sm",children:"No projects found"})})]})]})}function x(e){let{projects:t,selectedProjectId:r,onProjectChange:a,taskCount:n=0}=e;return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Processing Project"}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:[n," tasks"]})]}),(0,s.jsx)(m,{projects:t,selectedProjectId:r,onProjectChange:a,placeholder:"Select project to process...",includeInbox:!0}),(0,s.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:"\uD83D\uDCA1 Select a project to process its tasks. Use keyboard shortcuts: S to skip, Enter to process."})]})}function h(e){let{currentPriority:t,onPrioritySelect:r,onClose:n,isVisible:l}=e,i=e=>5-e,o=e=>{switch(i(e)){case 1:return"bg-red-500 border-red-500 text-white";case 2:return"bg-orange-500 border-orange-500 text-white";case 3:return"bg-blue-500 border-blue-500 text-white";default:return"bg-gray-500 border-gray-500 text-white"}},c=e=>{switch(i(e)){case 1:return"Urgent";case 2:return"High";case 3:return"Medium";default:return"Normal"}};return((0,a.useEffect)(()=>{if(!l)return;let e=e=>{switch(e.preventDefault(),e.stopPropagation(),e.key){case"1":r(4);break;case"2":r(3);break;case"3":r(2);break;case"4":r(1);break;case"Escape":case"`":case"p":case"P":n()}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[l,r,n]),l)?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,s.jsx)("div",{className:"bg-white rounded-2xl p-8 shadow-2xl max-w-lg w-full mx-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Set Priority"}),(0,s.jsx)("p",{className:"text-gray-600 mb-8",children:"Press 1, 2, 3, or 4 to select priority"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:[4,3,2,1].map(e=>{let a=i(e),n=t===e;return(0,s.jsxs)("button",{onClick:()=>r(e),className:"\n                    p-6 rounded-xl border-2 font-bold text-lg transition-all duration-200 transform\n                    ".concat(n?"".concat(o(e)," scale-105 shadow-lg"):"bg-gray-100 border-gray-300 text-gray-700 hover:bg-gray-200 hover:scale-102","\n                  "),children:[(0,s.jsxs)("div",{className:"text-3xl font-black mb-2",children:["P",a]}),(0,s.jsx)("div",{className:"text-sm opacity-90",children:c(e)}),(0,s.jsxs)("div",{className:"text-xs mt-2 opacity-75",children:["Press ",a]})]},e)})}),(0,s.jsxs)("div",{className:"mt-8 text-sm text-gray-500",children:["Release ",(0,s.jsx)("kbd",{className:"px-2 py-1 bg-gray-100 rounded",children:"P"})," key to close"]})]})})}):null}function b(e){let{projects:t,currentProjectId:r,currentTask:n,suggestions:l,onProjectSelect:i,onClose:o,isVisible:c}=e,[d,u]=(0,a.useState)(""),[g,m]=(0,a.useState)(0),x=(0,a.useRef)(null),h=(0,a.useRef)(null),b=e=>({berry_red:"#b8256f",red:"#db4035",orange:"#ff9933",yellow:"#fad000",olive_green:"#afb83b",lime_green:"#7ecc49",green:"#299438",mint_green:"#6accbc",teal:"#158fad",sky_blue:"#14aaf5",light_blue:"#96c3eb",blue:"#4073ff",grape:"#884dff",violet:"#af38eb",lavender:"#eb96eb",magenta:"#e05194",salmon:"#ff8d85",charcoal:"#808080",grey:"#b8b8b8",taupe:"#ccac93"})[e]||"#299fe6",f=(()=>{let e=new Map(t.map(e=>[e.id,e])),r=t.filter(e=>!e.parentId),s=[],a=new Set(l.map(e=>e.projectId));if(l.length>0){let e=0;l.forEach(r=>{let a=t.find(e=>e.id===r.projectId);a&&(!d||a.name.toLowerCase().includes(d.toLowerCase()))&&(s.push({...a,level:0,isSuggested:!0,confidence:r.confidence}),e++)}),e>0&&s.push({divider:!0})}let n=new Set,i=e=>{e.name.toLowerCase().includes(d.toLowerCase())&&n.add(e.id),t.filter(t=>t.parentId===e.id).forEach(i)};d&&t.forEach(i);let o=new Set(n);d&&n.forEach(t=>{let r=e.get(t);for(;null==r?void 0:r.parentId;)o.add(r.parentId),r=e.get(r.parentId)});let c=(e,r)=>{if(!d||o.has(e.id)){let t=a.has(e.id);s.push({...e,level:r,isAlsoSuggested:t})}t.filter(t=>t.parentId===e.id).forEach(e=>c(e,r+1))};return r.forEach(e=>c(e,0)),s})();(0,a.useEffect)(()=>{c&&(u(""),m(0),setTimeout(()=>{x.current&&x.current.focus()},100))},[c]),(0,a.useEffect)(()=>{if(d&&f.length>0&&0===g){let e=f.findIndex(e=>!("divider"in e)&&e.name.toLowerCase().includes(d.toLowerCase()));e>=0&&0!==e&&m(e)}},[d,f.length]),(0,a.useEffect)(()=>{g>=f.length&&m(Math.max(0,f.length-1))},[f.length,g]),(0,a.useEffect)(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})},[g]),(0,a.useEffect)(()=>{if(!c)return;let e=e=>{switch(e.key){case"ArrowDown":e.preventDefault(),m(e=>{let t=Math.min(e+1,f.length-1);for(;t<f.length&&"divider"in f[t];)t++;return Math.min(t,f.length-1)});break;case"ArrowUp":e.preventDefault(),m(e=>{let t=Math.max(e-1,0);for(;t>=0&&"divider"in f[t];)t--;return Math.max(t,0)});break;case"Enter":e.preventDefault();let t=f[g];!t||"divider"in t||p(t.id);break;case"Escape":case"`":e.preventDefault(),o()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,g,f]);let p=(0,a.useCallback)(e=>{i(e)},[i]);return c?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:o,children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200 bg-blue-50 rounded-t-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold text-sm",children:"#"})}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("h2",{className:"text-lg font-bold text-blue-900",children:"Select Project"})})]}),(0,s.jsx)("h3",{className:"text-sm font-medium text-blue-900 leading-tight",children:n.content})]}),(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,s.jsx)("input",{ref:x,type:"text",value:d,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"Search projects..."}),(0,s.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:"↑↓ to navigate • Enter to select • Esc to cancel"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===f.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:d?'No projects found for "'.concat(d,'"'):"No projects available"}):(0,s.jsx)("div",{className:"space-y-1",children:f.map((e,t)=>{if("divider"in e)return(0,s.jsx)("div",{className:"my-2 border-t border-gray-200"},"divider-".concat(t));let a=t===g,n=e.id===r,l=b(e.color),i=d&&e.name.toLowerCase().includes(d.toLowerCase()),o=d&&!i&&!e.isSuggested;return(0,s.jsxs)("button",{ref:a?h:null,onClick:()=>p(e.id),className:"\n                      w-full text-left p-3 rounded-md transition-all duration-150 flex items-center space-x-3 border\n                      ".concat(a?"bg-blue-50 border-blue-300":n?"bg-green-50 border-green-200":e.isSuggested?"hover:bg-indigo-50 border-transparent":"hover:bg-gray-50 border-transparent","\n                      ").concat(o?"opacity-60":"","\n                    "),style:{paddingLeft:"".concat(1+1.5*e.level,"rem")},children:[e.level>0&&!e.isSuggested&&(0,s.jsx)("div",{className:"flex items-center text-gray-400 -ml-2",children:"└".padStart(2*e.level,"  ")}),e.isSuggested&&(0,s.jsx)("div",{className:"flex items-center justify-center w-4 h-4 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex-shrink-0",children:(0,s.jsx)("span",{className:"text-[10px] font-bold text-white",children:"AI"})}),(0,s.jsx)("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:l}}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("div",{className:"font-medium text-sm ".concat(n?"text-green-800":"text-gray-900"),children:[e.name,n&&(0,s.jsx)("span",{className:"ml-2 text-green-600",children:"✓ Current"}),e.isAlsoSuggested&&(0,s.jsx)("span",{className:"ml-2 text-xs text-indigo-600",children:"AI suggested"}),e.isSuggested&&e.confidence&&(0,s.jsxs)("span",{className:"ml-2 text-xs ".concat(e.confidence>=.8?"text-green-600":e.confidence>=.6?"text-yellow-600":"text-gray-500"),children:[Math.round(100*e.confidence),"%"]})]})}),a&&(0,s.jsx)("div",{className:"text-xs font-bold text-blue-500",children:"↵"})]},e.isSuggested?"ai-".concat(e.id):e.id)})})})]})}):null}function f(e){let{labels:t,currentTask:r,onLabelsChange:n,onClose:l,isVisible:i}=e,[o,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(r.labels),[g,m]=(0,a.useState)(0),x=(0,a.useRef)(null),h=(0,a.useRef)(null),b=e=>({berry_red:"#b8256f",red:"#db4035",orange:"#ff9933",yellow:"#fad000",olive_green:"#afb83b",lime_green:"#7ecc49",green:"#299438",mint_green:"#6accbc",teal:"#158fad",sky_blue:"#14aaf5",light_blue:"#96c3eb",blue:"#4073ff",grape:"#884dff",violet:"#af38eb",lavender:"#eb96eb",magenta:"#e05194",salmon:"#ff8d85",charcoal:"#808080",grey:"#b8b8b8",taupe:"#ccac93"})[e]||"#299fe6",f=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase()));(0,a.useEffect)(()=>{i&&(c(""),u(r.labels),m(0),setTimeout(()=>{x.current&&x.current.focus()},100))},[i,r.labels]),(0,a.useEffect)(()=>{g>=f.length&&m(Math.max(0,f.length-1))},[f.length,g]),(0,a.useEffect)(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})},[g]),(0,a.useEffect)(()=>{if(!i)return;let e=e=>{switch(e.key){case"ArrowDown":e.preventDefault(),m(e=>Math.min(e+1,f.length-1));break;case"ArrowUp":e.preventDefault(),m(e=>Math.max(e-1,0));break;case"Enter":case" ":e.preventDefault(),f[g]&&p(f[g].name);break;case"Escape":case"`":e.preventDefault(),l()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[i,g,f]);let p=(0,a.useCallback)(e=>{let t=d.includes(e)?d.filter(t=>t!==e):[...d,e];u(t),n(t)},[d,n]);return i?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:l,children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200 bg-green-50 rounded-t-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold text-sm",children:"@"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-green-900",children:"Select Labels"}),(0,s.jsxs)("div",{className:"text-sm text-green-700 mt-1",children:[d.length," label",1!==d.length?"s":""," selected"]})]})]}),(0,s.jsx)("h3",{className:"text-sm font-medium text-green-900 leading-tight",children:r.content})]}),(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,s.jsx)("input",{ref:x,type:"text",value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",placeholder:"Search labels..."}),(0,s.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:"↑↓ to navigate • Enter/Space to toggle • Esc to cancel"})]}),d.length>0&&(0,s.jsx)("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-200",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:d.map(e=>{let r=t.find(t=>t.name===e),a=r?b(r.color):"#299fe6";return(0,s.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full flex items-center space-x-1",style:{backgroundColor:"".concat(a,"20"),color:a},children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:a}}),(0,s.jsx)("span",{children:e}),(0,s.jsx)("button",{onClick:()=>p(e),className:"ml-1 hover:scale-125 transition-transform",children:"\xd7"})]},e)})})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===f.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:o?'No labels found for "'.concat(o,'"'):"No labels available"}):(0,s.jsx)("div",{className:"space-y-1",children:f.map((e,t)=>{let r=t===g,a=d.includes(e.name),n=b(e.color);return(0,s.jsxs)("button",{ref:r?h:null,onClick:()=>p(e.name),className:"\n                      w-full text-left p-3 rounded-md transition-all duration-150 flex items-center space-x-3 border\n                      ".concat(r?"bg-green-50 border-green-300":a?"bg-gray-50 border-gray-200":"hover:bg-gray-50 border-transparent","\n                    "),children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("input",{type:"checkbox",checked:a,onChange:()=>{},className:"w-4 h-4 rounded focus:ring-green-500",style:{accentColor:n}})}),(0,s.jsx)("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:n}}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("div",{className:"font-medium text-sm text-gray-900",children:e.name})}),r&&(0,s.jsx)("div",{className:"text-xs font-bold text-green-500",children:"↵"})]},e.id)})})})]})}):null}let p=[/\b(today|tomorrow|yesterday)\b/gi,/\b(next|this)\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday|week|month|year)\b/gi,/\bin\s+(\d+)\s+(day|week|month|year)s?\b/gi,/\b(\d+)\s+(day|week|month|year)s?\s+(from\s+now|later)\b/gi,/\b(jan|january|feb|february|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|september|oct|october|nov|november|dec|december)\s+(\d{1,2})\b/gi,/\b(\d{1,2})\/(\d{1,2})(\/\d{2,4})?\b/gi,/\b(\d{1,2})-(\d{1,2})(-\d{2,4})?\b/gi,/\b(at\s+)?(\d{1,2}):(\d{2})\s*(am|pm)?\b/gi,/\b(at\s+)?(\d{1,2})\s*(am|pm)\b/gi,/\b(morning|afternoon|evening|night|noon|midnight)\b/gi,/\b(monday|tuesday|wednesday|thursday|friday|saturday|sunday|mon|tue|wed|thu|fri|sat|sun)\b/gi,/\b(end\s+of\s+(week|month|year)|beginning\s+of\s+(week|month|year))\b/gi,/\b(every\s+(day|week|month|year)|daily|weekly|monthly|yearly)\b/gi],y=(0,a.forwardRef)(function(e,t){let{value:r,onChange:n,placeholder:l="e.g., tomorrow, next friday, in 2 weeks..."}=e,[i,o]=(0,a.useState)([]),c=(0,a.useRef)(null),d=(0,a.useCallback)(e=>{if(!e)return void o([]);let t=0,r=[],a=[];p.forEach(t=>{let r;for(;null!==(r=t.exec(e));)a.push({start:r.index,end:r.index+r[0].length,match:r[0]})}),a.sort((e,t)=>e.start-t.start),a.filter((e,t)=>{if(0===t)return!0;let r=a[t-1];return e.start>=r.end}).forEach((a,n)=>{a.start>t&&r.push((0,s.jsx)("span",{className:"text-gray-900",children:e.slice(t,a.start)},"text-".concat(n))),r.push((0,s.jsx)("span",{className:"bg-blue-100 text-blue-800 px-1 rounded font-medium",children:a.match},"match-".concat(n))),t=a.end}),t<e.length&&r.push((0,s.jsx)("span",{className:"text-gray-900",children:e.slice(t)},"remaining")),o(r)},[]);(0,a.useEffect)(()=>{d(r)},[r,d]);let u=i.some(e=>{var t;return null==(t=e.props.className)?void 0:t.includes("bg-blue-100")});return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 px-3 py-2 pointer-events-none whitespace-pre-wrap break-words text-transparent border border-transparent",style:{font:"inherit",lineHeight:"inherit",wordWrap:"break-word",whiteSpace:"pre-wrap"},children:i.length>0?i:(0,s.jsx)("span",{className:"text-gray-400",children:r?"":l})}),(0,s.jsx)("input",{ref:t||c,type:"text",value:r,onChange:e=>{let t=e.target.value;n(t),d(t)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-todoist-blue focus:border-transparent bg-transparent relative z-10",placeholder:l,style:{color:"transparent"}})]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"text-gray-500",children:'Use natural language like "tomorrow", "next Friday", "in 2 weeks"'}),r&&(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(u?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:u?"✓ Recognized":"⚠ May not parse correctly"})]})]})});function k(e){let{currentTask:t,onScheduledDateChange:r,onClose:n,isVisible:l}=e,[i,o]=(0,a.useState)(""),[c,d]=(0,a.useState)(0),u=(0,a.useRef)(null),g=(0,a.useRef)(null),m=e=>5-e,x=(0,a.useCallback)(()=>{let e=new Date,r=[],s=m(t.priority);if(1===s?r.push({id:"now",label:"Right now",sublabel:"Start immediately",dateString:"now",icon:"\uD83D\uDD25"},{id:"today",label:"Today",sublabel:"Within the day",dateString:"today",icon:"\uD83D\uDCC5"},{id:"tomorrow-morning",label:"Tomorrow morning",sublabel:"Early start",dateString:"tomorrow at 9am",icon:"\uD83C\uDF05"}):2===s?r.push({id:"today",label:"Today",sublabel:"Get it done today",dateString:"today",icon:"\uD83D\uDCC5"},{id:"tomorrow",label:"Tomorrow",sublabel:"Next business day",dateString:"tomorrow",icon:"➡️"},{id:"monday",label:"Monday morning",sublabel:"Start of week",dateString:"Monday at 9am",icon:"\uD83C\uDF05"}):r.push({id:"tomorrow",label:"Tomorrow",sublabel:"Next day",dateString:"tomorrow",icon:"➡️"},{id:"next-week",label:"Next week",sublabel:"When you have time",dateString:"next Monday",icon:"\uD83D\uDCC5"},{id:"weekend",label:"This weekend",sublabel:"Saturday morning",dateString:"Saturday at 10am",icon:"\uD83C\uDFE0"}),t.deadline){let s=Math.ceil((new Date(t.deadline.date).getTime()-e.getTime())/864e5);s>7&&r.push({id:"week-before",label:"Week before deadline",sublabel:"Leave time for completion",dateString:"in "+(s-7)+" days",icon:"⏰"}),s>3&&r.push({id:"few-days-before",label:"Few days before deadline",sublabel:"Final push",dateString:"in "+(s-3)+" days",icon:"⚡"})}r.push({id:"tonight",label:"Tonight",sublabel:"After work",dateString:"today at 7pm",icon:"\uD83C\uDF19"},{id:"lunch",label:"During lunch",sublabel:"Quick session",dateString:"today at 12pm",icon:"\uD83C\uDF7D️"},{id:"end-of-week",label:"End of week",sublabel:"Friday afternoon",dateString:"Friday at 3pm",icon:"\uD83D\uDCCB"});let a=e=>{let t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate());if("now"===e)return t;if("today"===e)return r;if(e.startsWith("today at")){let t=e.replace("today at ",""),[s]=t.replace(/[ap]m/i,"").split(":"),a=parseInt(s);return t.includes("pm")&&12!==a&&(a+=12),t.includes("am")&&12===a&&(a=0),new Date(r.getFullYear(),r.getMonth(),r.getDate(),a)}if("tomorrow"===e){let e=new Date(r);return e.setDate(e.getDate()+1),e}if(e.startsWith("tomorrow at")){let t=new Date(r);t.setDate(t.getDate()+1);let s=e.replace("tomorrow at ",""),[a]=s.replace(/[ap]m/i,"").split(":"),n=parseInt(a);return s.includes("pm")&&12!==n&&(n+=12),s.includes("am")&&12===n&&(n=0),t.setHours(n),t}if(e.startsWith("in ")&&e.includes("days")){var s;let t=parseInt((null==(s=e.match(/\d+/))?void 0:s[0])||"1"),a=new Date(r);return a.setDate(a.getDate()+t),a}if("Saturday"===e||e.startsWith("Saturday at")){let s=(6-t.getDay()+7)%7||7,a=new Date(r);if(a.setDate(a.getDate()+s),e.includes(" at ")){let t=e.replace("Saturday at ",""),[r]=t.replace(/[ap]m/i,"").split(":"),s=parseInt(r);t.includes("pm")&&12!==s&&(s+=12),t.includes("am")&&12===s&&(s=0),a.setHours(s)}return a}if("Monday"===e||e.startsWith("Monday at")){let s=(1-t.getDay()+7)%7||7,a=new Date(r);if(a.setDate(a.getDate()+s),e.includes(" at ")){let t=e.replace("Monday at ",""),[r]=t.replace(/[ap]m/i,"").split(":"),s=parseInt(r);t.includes("pm")&&12!==s&&(s+=12),t.includes("am")&&12===s&&(s=0),a.setHours(s)}return a}if("Friday"===e||e.startsWith("Friday at")){let s=(5-t.getDay()+7)%7||7,a=new Date(r);if(a.setDate(a.getDate()+s),e.includes(" at ")){let t=e.replace("Friday at ",""),[r]=t.replace(/[ap]m/i,"").split(":"),s=parseInt(r);t.includes("pm")&&12!==s&&(s+=12),t.includes("am")&&12===s&&(s=0),a.setHours(s)}return a}if(e.startsWith("next ")){let e=new Date(r);return e.setDate(e.getDate()+7),e}return new Date(t.getFullYear()+1,0,1)};return r.filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id)).sort((e,t)=>{let r=a(e.dateString),s=a(t.dateString);return r.getTime()-s.getTime()})},[t.priority,t.deadline])(),h=(()=>{let e=x.filter(e=>{var t;return e.label.toLowerCase().includes(i.toLowerCase())||(null==(t=e.sublabel)?void 0:t.toLowerCase().includes(i.toLowerCase()))||e.dateString.toLowerCase().includes(i.toLowerCase())});return i.trim()&&!e.some(e=>e.dateString.toLowerCase()===i.toLowerCase())&&e.unshift({id:"custom",label:'"'.concat(i,'"'),sublabel:"Use your custom input",dateString:i,icon:"✏️"}),e})();(0,a.useEffect)(()=>{l&&(o(""),d(0),setTimeout(()=>{u.current&&u.current.focus()},100))},[l]),(0,a.useEffect)(()=>{c>=h.length&&d(Math.max(0,h.length-1))},[h.length,c]),(0,a.useEffect)(()=>{g.current&&g.current.scrollIntoView({behavior:"smooth",block:"center"})},[c]),(0,a.useEffect)(()=>{if(!l)return;let e=e=>{switch(e.key){case"ArrowDown":e.preventDefault(),d(e=>Math.min(e+1,h.length-1));return;case"ArrowUp":e.preventDefault(),d(e=>Math.max(e-1,0));return;case"Enter":e.preventDefault(),i.trim()?b(i.trim()):h[c]&&b(h[c].dateString);return;case"Escape":case"`":e.preventDefault(),n();return;case"Tab":return}u.current&&document.activeElement!==u.current&&(1===e.key.length||"Backspace"===e.key||"Delete"===e.key)&&(e.preventDefault(),u.current.focus(),1===e.key.length?o(t=>t+e.key):"Backspace"===e.key&&o(e=>e.slice(0,-1)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,c,h,i]);let b=e=>{r(e),n()},f=(0,a.useCallback)(e=>{b(e)},[]);return l?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:n,children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200 bg-blue-50 rounded-t-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-blue-900",children:"Schedule Task"}),(0,s.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,s.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-md border ".concat((e=>{switch(m(e)){case 1:return"text-red-600 bg-red-50 border-red-200";case 2:return"text-orange-600 bg-orange-50 border-orange-200";case 3:return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})(t.priority)),children:["P",m(t.priority)]})})]})]}),(0,s.jsx)("h3",{className:"text-sm font-medium text-blue-900 leading-tight",children:t.content})]}),(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,s.jsx)(y,{ref:u,value:i,onChange:o,placeholder:"When will you work on this? (e.g., tomorrow, next week)"}),(0,s.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:"Type or select from suggestions below • ↑↓ to navigate • Enter to apply"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[t.due&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium text-blue-800",children:"Currently scheduled: "}),(0,s.jsx)("span",{className:"text-blue-700",children:t.due.string})]}),(0,s.jsx)("button",{onClick:()=>{r(""),n()},className:"text-xs text-blue-600 hover:text-blue-800 hover:underline",children:"Clear"})]})}),0===h.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:i?'No suggestions for "'.concat(i,'"'):"No suggestions available"}):(0,s.jsx)("div",{className:"space-y-1",children:h.map((e,t)=>{let r=t===c;return(0,s.jsxs)("button",{ref:r?g:null,onClick:()=>f(e.dateString),className:"\n                      w-full text-left p-3 rounded-md transition-all duration-150 flex items-center space-x-3 border\n                      ".concat(r?"bg-blue-50 border-blue-300":"custom"===e.id?"bg-green-50 border-green-200 hover:bg-green-100":"hover:bg-gray-50 border-transparent","\n                    "),children:[(0,s.jsx)("div",{className:"text-sm flex-shrink-0",children:e.icon}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-medium text-sm ".concat("custom"===e.id?"text-green-800":"text-gray-900"),children:e.label}),e.sublabel&&(0,s.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.sublabel})]}),r&&(0,s.jsx)("div",{className:"text-xs font-bold ".concat("custom"===e.id?"text-green-600":"text-blue-500"),children:"↵"})]},e.id)})})]})]})}):null}function j(e){let{currentTask:t,onDeadlineChange:r,onClose:n,isVisible:l}=e,[i,o]=(0,a.useState)(""),[c,d]=(0,a.useState)(0),u=(0,a.useRef)(null),g=(0,a.useRef)(null),m=e=>5-e,x=(0,a.useCallback)(()=>{let e=new Date,r=[],s=m(t.priority);if(1===s?r.push({id:"today",label:"End of today",sublabel:"Must be done today",dateString:"today",icon:"\uD83D\uDD25"},{id:"tomorrow",label:"Tomorrow",sublabel:"Absolute deadline",dateString:"tomorrow",icon:"⚡"},{id:"end-of-week",label:"End of week",sublabel:"Latest possible",dateString:"Friday",icon:"\uD83D\uDCCB"}):2===s?r.push({id:"end-of-week",label:"End of week",sublabel:"This Friday",dateString:"Friday",icon:"\uD83D\uDCCB"},{id:"next-week",label:"Next week",sublabel:"Next Friday",dateString:"next Friday",icon:"\uD83D\uDCC5"},{id:"two-weeks",label:"In 2 weeks",sublabel:"Reasonable timeline",dateString:"in 2 weeks",icon:"\uD83D\uDDD3️"}):r.push({id:"next-week",label:"Next week",sublabel:"End of next week",dateString:"next Friday",icon:"\uD83D\uDCC5"},{id:"end-of-month",label:"End of month",sublabel:"Monthly goal",dateString:"end of month",icon:"\uD83D\uDDD3️"},{id:"next-month",label:"Next month",sublabel:"Flexible deadline",dateString:"next month",icon:"\uD83D\uDCC6"}),t.due){let s=new Date(t.due.date),a=new Date(e);if(a.setDate(a.getDate()+1),s<=a)r.unshift({id:"after-scheduled",label:"Day after scheduled",sublabel:"Complete after working on it",dateString:"in 2 days",icon:"✅"});else{let t=Math.ceil((s.getTime()-e.getTime())/864e5);r.unshift({id:"week-after-scheduled",label:"Week after scheduled",sublabel:"Time to complete after starting",dateString:"in ".concat(t+7," days"),icon:"✅"})}}r.push({id:"eod-today",label:"End of today",sublabel:"Due by end of day",dateString:"today",icon:"\uD83D\uDD54"},{id:"monday",label:"Next Monday",sublabel:"Start of week",dateString:"next Monday",icon:"\uD83D\uDCCA"},{id:"quarter-end",label:"End of quarter",sublabel:"Quarterly goal",dateString:"end of quarter",icon:"\uD83C\uDFAF"});let a=e=>{var t,r;let s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate());if("today"===e)return a;if("tomorrow"===e){let e=new Date(a);return e.setDate(e.getDate()+1),e}if(e.startsWith("in ")&&e.includes("days")){let r=parseInt((null==(t=e.match(/\d+/))?void 0:t[0])||"1"),s=new Date(a);return s.setDate(s.getDate()+r),s}if(e.startsWith("in ")&&e.includes("weeks")){let t=parseInt((null==(r=e.match(/\d+/))?void 0:r[0])||"1"),s=new Date(a);return s.setDate(s.getDate()+7*t),s}if("Friday"===e){let e=(5-s.getDay()+7)%7||7,t=new Date(a);return t.setDate(t.getDate()+e),t}if("next Friday"===e){let e=(5-s.getDay()+7)%7||7,t=new Date(a);return t.setDate(t.getDate()+e+7),t}if("next Monday"===e){let e=(1-s.getDay()+7)%7||7,t=new Date(a);return t.setDate(t.getDate()+e),t}if("end of month"===e)return new Date(s.getFullYear(),s.getMonth()+1,0);if("next month"===e)return new Date(s.getFullYear(),s.getMonth()+1,1);if("end of quarter"===e){let e=Math.floor(s.getMonth()/3);return new Date(s.getFullYear(),(e+1)*3,0)}return new Date(s.getFullYear()+1,0,1)};return r.filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id)).sort((e,t)=>{let r=a(e.dateString),s=a(t.dateString);return r.getTime()-s.getTime()})},[t.priority,t.due])(),h=(()=>{let e=x.filter(e=>{var t;return e.label.toLowerCase().includes(i.toLowerCase())||(null==(t=e.sublabel)?void 0:t.toLowerCase().includes(i.toLowerCase()))||e.dateString.toLowerCase().includes(i.toLowerCase())});return i.trim()&&!e.some(e=>e.dateString.toLowerCase()===i.toLowerCase())&&e.unshift({id:"custom",label:'"'.concat(i,'"'),sublabel:"Use your custom input",dateString:i,icon:"✏️"}),e})();(0,a.useEffect)(()=>{l&&(o(""),d(0),setTimeout(()=>{u.current&&u.current.focus()},100))},[l]),(0,a.useEffect)(()=>{c>=h.length&&d(Math.max(0,h.length-1))},[h.length,c]),(0,a.useEffect)(()=>{g.current&&g.current.scrollIntoView({behavior:"smooth",block:"center"})},[c]),(0,a.useEffect)(()=>{if(!l)return;let e=e=>{switch(e.key){case"ArrowDown":e.preventDefault(),d(e=>Math.min(e+1,h.length-1));return;case"ArrowUp":e.preventDefault(),d(e=>Math.max(e-1,0));return;case"Enter":e.preventDefault(),i.trim()?b(i.trim()):h[c]&&b(h[c].dateString);return;case"Escape":case"`":e.preventDefault(),n();return;case"Tab":return}u.current&&document.activeElement!==u.current&&(1===e.key.length||"Backspace"===e.key||"Delete"===e.key)&&(e.preventDefault(),u.current.focus(),1===e.key.length?o(t=>t+e.key):"Backspace"===e.key&&o(e=>e.slice(0,-1)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,c,h,i]);let b=e=>{r(e),n()},f=(0,a.useCallback)(e=>{b(e)},[]);return l?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:n,children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200 bg-red-50 rounded-t-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-red-900",children:"Set Deadline"}),(0,s.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,s.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-md border ".concat((e=>{switch(m(e)){case 1:return"text-red-600 bg-red-50 border-red-200";case 2:return"text-orange-600 bg-orange-50 border-orange-200";case 3:return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})(t.priority)),children:["P",m(t.priority)]})})]})]}),(0,s.jsx)("h3",{className:"text-sm font-medium text-red-900 leading-tight",children:t.content})]}),(0,s.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,s.jsx)(y,{ref:u,value:i,onChange:o,placeholder:"When must this be done? (e.g., Friday, end of week)"}),(0,s.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:"Type or select from suggestions below • ↑↓ to navigate • Enter to apply"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[t.deadline&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium text-red-800",children:"Current deadline: "}),(0,s.jsx)("span",{className:"text-red-700",children:t.deadline.string})]}),(0,s.jsx)("button",{onClick:()=>{r(""),n()},className:"text-xs text-red-600 hover:text-red-800 hover:underline",children:"Clear"})]})}),0===h.length?(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:i?'No suggestions for "'.concat(i,'"'):"No suggestions available"}):(0,s.jsx)("div",{className:"space-y-1",children:h.map((e,t)=>{let r=t===c;return(0,s.jsxs)("button",{ref:r?g:null,onClick:()=>f(e.dateString),className:"\n                      w-full text-left p-3 rounded-md transition-all duration-150 flex items-center space-x-3 border\n                      ".concat(r?"bg-red-50 border-red-300":"custom"===e.id?"bg-green-50 border-green-200 hover:bg-green-100":"hover:bg-gray-50 border-transparent","\n                    "),children:[(0,s.jsx)("div",{className:"text-sm flex-shrink-0",children:e.icon}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-medium text-sm ".concat("custom"===e.id?"text-green-800":"text-gray-900"),children:e.label}),e.sublabel&&(0,s.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.sublabel})]}),r&&(0,s.jsx)("div",{className:"text-xs font-bold ".concat("custom"===e.id?"text-green-600":"text-red-500"),children:"↵"})]},e.id)})})]})]})}):null}function v(e){let{task:t,projects:r,suggestions:a,onProjectSelect:n}=e,l=e=>e>=.8?"text-green-600 bg-green-50 border-green-200":e>=.6?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-gray-600 bg-gray-50 border-gray-200",i=e=>{let t=r.find(t=>t.id===e);return t&&({berry_red:"#b8256f",red:"#db4035",orange:"#ff9933",yellow:"#fad000",olive_green:"#afb83b",lime_green:"#7ecc49",green:"#299438",mint_green:"#6accbc",teal:"#158fad",sky_blue:"#14aaf5",light_blue:"#96c3eb",blue:"#4073ff",grape:"#884dff",violet:"#af38eb",lavender:"#eb96eb",magenta:"#e05194",salmon:"#ff8d85",charcoal:"#808080",grey:"#b8b8b8",taupe:"#ccac93"})[t.color]||"#299fe6"};return a.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-4 border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Suggested Projects"}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"AI-powered suggestions"})]}),(0,s.jsx)("div",{className:"space-y-2",children:a.slice(0,3).map((e,t)=>(0,s.jsxs)("button",{onClick:()=>n(e.projectId),className:"w-full text-left p-3 rounded-md border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-colors group",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:i(e.projectId)}}),(0,s.jsx)("span",{className:"font-medium text-gray-900 text-sm",children:e.projectName})]}),(0,s.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-md border ".concat(l(e.confidence)),children:[Math.round(100*e.confidence),"%"]})]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 group-hover:text-gray-700",children:e.reasoning})]},"".concat(e.projectId,"-").concat(t)))})]}):(console.log("ProjectSuggestions: No suggestions available"),null)}function w(e){let{message:t,type:r,onClose:n,duration:l=3e3}=e;return(0,a.useEffect)(()=>{let e=setTimeout(()=>{n()},l);return()=>clearTimeout(e)},[l,n]),(0,s.jsx)("div",{className:"fixed bottom-4 right-4 animate-slide-up z-50",children:(0,s.jsxs)("div",{className:"".concat({success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"}[r]," text-white px-4 py-3 rounded-lg shadow-lg flex items-center space-x-2 min-w-[250px]"),children:[(0,s.jsx)("span",{className:"text-lg font-bold",children:{success:"✓",error:"✕",info:"ℹ"}[r]}),(0,s.jsx)("span",{className:"text-sm font-medium",children:t}),(0,s.jsx)("button",{onClick:n,className:"ml-auto text-white/80 hover:text-white",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})})}function N(){var e,t,r,n;let[i,m]=(0,a.useState)({currentTask:null,queuedTasks:[],processedTasks:[],skippedTasks:[]}),[p,y]=(0,a.useState)([]),[N,T]=(0,a.useState)([]),[C,S]=(0,a.useState)(null),[E,D]=(0,a.useState)(!1),[L,I]=(0,a.useState)(!0),[P,M]=(0,a.useState)(!1),[A,_]=(0,a.useState)(null),[F,R]=(0,a.useState)(""),[W,z]=(0,a.useState)([]),[q,H]=(0,a.useState)(0),[V,U]=(0,a.useState)(!1),[B,O]=(0,a.useState)(!1),[Y,G]=(0,a.useState)(!1),[J,K]=(0,a.useState)(!1),[Z,Q]=(0,a.useState)(!1),[X,$]=(0,a.useState)(!1),[ee,et]=(0,a.useState)(!1),[er,es]=(0,a.useState)(null),[ea,en]=(0,a.useState)([]);(0,a.useEffect)(()=>{!async function(){try{I(!0),_(null);let[e,t,r]=await Promise.all([fetch("/api/todoist/projects"),fetch("/api/todoist/labels"),fetch("/api/projects/hierarchy?format=context")]);if(!e.ok||!t.ok||!r.ok)throw Error("Failed to fetch data from Todoist API");let[s,a,n]=await Promise.all([e.json(),t.json(),r.json()]);y(s),T(a),S(n);let l=s.find(e=>e.isInboxProject);R((null==l?void 0:l.id)||"inbox")}catch(e){console.error("Error loading initial data:",e),_(e instanceof Error?e.message:"Failed to load data")}finally{I(!1)}}()},[]);let el=(0,a.useCallback)(async e=>{if(e)try{M(!0),_(null),console.log("Loading tasks for project:",e);let t=await fetch("/api/todoist/tasks?projectId=".concat(e));if(!t.ok)throw Error("Failed to fetch tasks");let r=await t.json();console.log("Loaded tasks:",r);let s=r.filter(e=>!e.content.startsWith("* "));if(z(s),s.length>0&&C)try{await o.prefetchSuggestions(s,C)}catch(e){console.warn("Failed to prefetch suggestions:",e)}s.length>0?(m({currentTask:s[0],queuedTasks:s.slice(1),processedTasks:[],skippedTasks:[]}),H(e=>e+1)):m({currentTask:null,queuedTasks:[],processedTasks:[],skippedTasks:[]})}catch(e){console.error("Error loading project tasks:",e),_(e instanceof Error?e.message:"Failed to load tasks")}finally{M(!1)}},[]);(0,a.useEffect)(()=>{p.length>0&&F&&el(F)},[F,p.length,el]),(0,a.useEffect)(()=>{!async function(){if(!i.currentTask||!C)return en([]);try{let e=(await o.generateSuggestions(i.currentTask.id,i.currentTask.content,i.currentTask.description||"",C,i.currentTask.projectId)).filter(e=>{let t=p.find(t=>t.id===e.projectId);return t&&!t.isInboxProject});console.log("TaskProcessor: Setting suggestions for task ".concat(i.currentTask.id,":"),e),en(e)}catch(e){console.error("Error loading suggestions:",e),en([])}}()},[null==(e=i.currentTask)?void 0:e.id,null==(t=i.currentTask)?void 0:t.content,null==(r=i.currentTask)?void 0:r.description,C,p]);let ei=(0,a.useCallback)(()=>{m(e=>{let t=e.queuedTasks[0]||null,r=e.queuedTasks.slice(1);if(t&&(H(e=>e+1),C&&r.length>0)){let e=r.slice(0,3);o.prefetchSuggestions(e,C).catch(e=>{console.warn("Failed to prefetch suggestions for upcoming tasks:",e)})}return{...e,currentTask:t,queuedTasks:r}})},[C]),eo=(0,a.useCallback)(async(e,t)=>{try{console.log("TaskProcessor.autoSaveTask called with:",{taskId:e,updates:t});let r=await fetch("/api/todoist/tasks/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("API Response status:",r.status),!r.ok){let e=await r.json();throw console.error("API Response error:",e),Error("Failed to update task: ".concat(e.error||r.statusText))}let s=await r.json();console.log("API Response data:",s)}catch(e){throw console.error("Error auto-saving task:",e),es({message:e instanceof Error?e.message:"Failed to save changes",type:"error"}),e}},[]),ec=(0,a.useCallback)(async e=>{i.currentTask&&(o.invalidateTask(i.currentTask.id),await eo(i.currentTask.id,{content:e}))},[i.currentTask,eo]);(0,a.useCallback)(()=>{i.currentTask&&(m(e=>({...e,processedTasks:[...e.processedTasks,e.currentTask.id]})),ei())},[i.currentTask,ei]);let ed=(0,a.useCallback)(async e=>{if(U(!1),i.currentTask){let t=i.currentTask.priority;m(t=>({...t,currentTask:t.currentTask?{...t.currentTask,priority:e}:null}));try{await eo(i.currentTask.id,{priority:e})}catch(e){m(e=>({...e,currentTask:e.currentTask?{...e.currentTask,priority:t}:null}))}}},[i.currentTask,eo]),eu=(0,a.useCallback)(async e=>{if(O(!1),i.currentTask){let t=i.currentTask.projectId;m(t=>({...t,currentTask:t.currentTask?{...t.currentTask,projectId:e}:null}));try{await eo(i.currentTask.id,{projectId:e})}catch(e){m(e=>({...e,currentTask:e.currentTask?{...e.currentTask,projectId:t}:null}))}}},[i.currentTask,eo]),eg=(0,a.useCallback)(async e=>{if(i.currentTask){let t=i.currentTask.labels;m(t=>({...t,currentTask:t.currentTask?{...t.currentTask,labels:e}:null}));try{await eo(i.currentTask.id,{labels:e})}catch(e){m(e=>({...e,currentTask:e.currentTask?{...e.currentTask,labels:t}:null}))}}},[i.currentTask,eo]),em=(0,a.useCallback)(async e=>{i.currentTask&&(o.invalidateTask(i.currentTask.id),m(t=>({...t,currentTask:t.currentTask?{...t.currentTask,description:e}:null})),await eo(i.currentTask.id,{description:e}))},[i.currentTask,eo]),ex=(0,a.useCallback)(e=>{i.currentTask&&eg(i.currentTask.labels.filter(t=>t!==e))},[i.currentTask,eg]),eh=(0,a.useCallback)(()=>{i.currentTask&&(m(e=>({...e,processedTasks:[...e.processedTasks,e.currentTask.id]})),ei())},[i.currentTask,ei]),eb=(0,a.useCallback)(()=>{0!==i.processedTasks.length&&(m(e=>{let t=e.processedTasks[e.processedTasks.length-1],r=W.find(e=>e.id===t);return r?{...e,currentTask:r,queuedTasks:e.currentTask?[e.currentTask,...e.queuedTasks]:e.queuedTasks,processedTasks:e.processedTasks.slice(0,-1)}:e}),H(e=>e+1))},[i.processedTasks,W]),ef=(0,a.useCallback)(async e=>{if(i.currentTask)try{e?m(t=>({...t,currentTask:t.currentTask?{...t.currentTask,due:{date:e,string:e,recurring:!1}}:null})):m(e=>({...e,currentTask:e.currentTask?{...e.currentTask,due:void 0}:null})),await eo(i.currentTask.id,{dueString:e})}catch(e){console.error("Error updating scheduled date:",e),m(e=>({...e,currentTask:e.currentTask?{...e.currentTask,due:i.currentTask.due}:null}))}},[i.currentTask,eo]),ep=(0,a.useCallback)(async e=>{if(i.currentTask)try{e?m(t=>({...t,currentTask:t.currentTask?{...t.currentTask,deadline:{date:e,string:e}}:null})):m(e=>({...e,currentTask:e.currentTask?{...e.currentTask,deadline:void 0}:null})),await eo(i.currentTask.id,{deadline:e})}catch(e){console.error("Error updating deadline:",e),m(e=>({...e,currentTask:e.currentTask?{...e.currentTask,deadline:i.currentTask.deadline}:null}))}},[i.currentTask,eo]),ey=(0,a.useCallback)(async()=>{if(i.currentTask){try{if(!(await fetch("/api/todoist/tasks/".concat(i.currentTask.id),{method:"DELETE"})).ok)throw Error("Failed to archive task");m(e=>({...e,processedTasks:[...e.processedTasks,e.currentTask.id]})),ei(),es({message:"Task archived successfully",type:"success"})}catch(e){console.error("Error archiving task:",e),es({message:e instanceof Error?e.message:"Failed to archive task",type:"error"})}$(!1)}},[i.currentTask,ei]),ek=(0,a.useCallback)(async()=>{if(i.currentTask){try{if(!(await fetch("/api/todoist/tasks/".concat(i.currentTask.id),{method:"DELETE"})).ok)throw Error("Failed to complete task");m(e=>({...e,processedTasks:[...e.processedTasks,e.currentTask.id]})),ei(),es({message:"Task completed successfully",type:"success"})}catch(e){console.error("Error completing task:",e),es({message:e instanceof Error?e.message:"Failed to complete task",type:"error"})}et(!1)}},[i.currentTask,ei]);(0,a.useCallback)(()=>{i.currentTask&&(m(e=>({...e,skippedTasks:[...e.skippedTasks,e.currentTask.id]})),ei())},[i.currentTask,ei]),(0,a.useEffect)(()=>{let e=e=>{if(!V&&!B&&!Y&&!J&&!Z&&!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||document.querySelector('[role="listbox"]')||document.querySelector(".dropdown-open")))switch(e.key){case"p":case"P":e.preventDefault(),U(!0);break;case"#":e.preventDefault(),O(!0);break;case"@":e.preventDefault(),G(!0);break;case"s":case"S":e.preventDefault(),K(!0);break;case"d":case"D":e.preventDefault(),Q(!0);break;case"j":case"J":case"Enter":case"ArrowRight":e.preventDefault(),eh();break;case"k":case"K":case"ArrowLeft":e.preventDefault(),eb();break;case"e":case"E":e.preventDefault(),$(!0);break;case"c":case"C":e.preventDefault(),et(!0);break;case"?":e.preventDefault(),D(!E);break;case"Escape":case"`":D(!1),U(!1),O(!1),G(!1),K(!1),Q(!1),$(!1),et(!1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eh,eb,E,V,B,Y,J,Z]);let ej=W.length,ev=i.processedTasks.length+i.skippedTasks.length,ew=ej>0?ev/ej*100:0;if(L)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-todoist-blue mx-auto"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mt-4",children:"Loading Todoist Data..."}),(0,s.jsx)("p",{className:"text-gray-600",children:"Fetching your inbox tasks, projects, and labels"})]})});if(A)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"❌"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-red-600 mb-2",children:"Error Loading Data"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:A}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-todoist-blue text-white rounded-md hover:bg-blue-600 transition-colors",children:"Retry"})]})});if(!i.currentTask&&0===i.queuedTasks.length&&!L){let e="inbox"===F?"Inbox":(null==(n=p.find(e=>e.id===F))?void 0:n.name)||"Project";return(0,s.jsxs)("div",{className:"min-h-screen p-4",children:[(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Task Processor"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(l(),{href:"/projects",className:"px-3 py-1 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 rounded-md transition-colors",children:"Projects"}),(0,s.jsxs)("button",{onClick:()=>D(!E),className:"px-3 py-1 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 rounded-md transition-colors",children:["Shortcuts ",(0,s.jsx)("span",{className:"kbd",children:"?"})]})]})]}),(0,s.jsx)(x,{projects:p,selectedProjectId:F,onProjectChange:R,taskCount:ej}),P&&(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-todoist-blue"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Loading tasks..."})]})})]}),!P&&(0,s.jsx)("div",{className:"flex items-center justify-center",style:{minHeight:"50vh"},children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:0===ej?"\uD83D\uDCED":"\uD83C\uDF89"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:0===ej?"".concat(e," is Empty"):"".concat(e," Complete!")}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:0===ej?"No tasks found in ".concat(e,". Try selecting a different project."):"All tasks have been processed."}),ej>0&&(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["Processed: ",i.processedTasks.length," • Skipped: ",i.skippedTasks.length]}),(0,s.jsx)("button",{onClick:()=>el(F),className:"mt-4 px-4 py-2 bg-todoist-blue text-white rounded-md hover:bg-blue-600 transition-colors",children:"Refresh Tasks"})]})})]}),E&&(0,s.jsx)(u,{onClose:()=>D(!1)})]})}return(0,s.jsxs)("div",{className:"min-h-screen p-4",children:[(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Task Processor"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(l(),{href:"/projects",className:"px-3 py-1 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 rounded-md transition-colors",children:"Projects"}),(0,s.jsxs)("button",{onClick:()=>D(!E),className:"px-3 py-1 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 rounded-md transition-colors",children:["Shortcuts ",(0,s.jsx)("span",{className:"kbd",children:"?"})]})]})]}),(0,s.jsx)(x,{projects:p,selectedProjectId:F,onProjectChange:R,taskCount:ej}),P&&(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-todoist-blue"}),(0,s.jsx)("span",{className:"text-gray-600",children:"Loading tasks..."})]})}),ej>0&&(0,s.jsx)(g,{current:ev+1,total:ej,progress:ew})]}),i.currentTask&&!P&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(c,{task:i.currentTask,projects:p,labels:N,onContentChange:ec,onDescriptionChange:em,onProjectClick:()=>O(!0),onPriorityClick:()=>U(!0),onLabelAdd:()=>G(!0),onLabelRemove:ex,onScheduledClick:()=>K(!0),onDeadlineClick:()=>Q(!0)}),ea.length>0&&(0,s.jsx)(v,{task:i.currentTask,projects:p,suggestions:ea,onProjectSelect:eu}),(0,s.jsx)(d,{task:i.currentTask,projects:p,labels:N,suggestions:function(e){let t=[],r=e.toLowerCase();return r.includes("call")||r.includes("phone")||r.includes("mom")||r.includes("family")?t.push({type:"project",suggestion:"Personal",confidence:.85,reasoning:"Personal communication task"}):r.includes("work")||r.includes("meeting")||r.includes("report")||r.includes("budget")?t.push({type:"project",suggestion:"Work",confidence:.9,reasoning:"Work-related task"}):(r.includes("buy")||r.includes("shop")||r.includes("groceries"))&&t.push({type:"project",suggestion:"Shopping",confidence:.95,reasoning:"Shopping or purchasing task"}),(r.includes("call")||r.includes("phone"))&&t.push({type:"label",suggestion:"phone",confidence:.9,reasoning:"Phone communication required"}),(r.includes("urgent")||r.includes("asap")||r.includes("important"))&&t.push({type:"label",suggestion:"urgent",confidence:.8,reasoning:"Task indicates urgency"}),r.includes("urgent")||r.includes("asap")||r.includes("critical")?t.push({type:"priority",suggestion:"4",confidence:.85,reasoning:"High priority language detected"}):(r.includes("important")||r.includes("deadline"))&&t.push({type:"priority",suggestion:"3",confidence:.75,reasoning:"Medium-high priority indicated"}),(r.length<30||!r.includes(" "))&&t.push({type:"rewrite",suggestion:function(e){let t=e.toLowerCase();if(t.includes("call mom"))return"Call mom to discuss weekend plans and confirm dinner time";if(t.includes("buy groceries"))return"Go to grocery store and buy milk, bread, eggs, and vegetables for the week";if(t.includes("fix")&&t.includes("website"))return"Investigate and fix the 404 error on website contact page";if(t.includes("dentist"))return"Call dentist office to schedule routine cleaning appointment";if(t.includes("review")&&t.includes("budget"))return"Review Q4 budget report and prepare summary for board meeting";return"Complete task: ".concat(e," - add specific details and next actions")}(e),confidence:.7,reasoning:"Make task more specific and actionable"}),t}(i.currentTask.content),onAutoSave:e=>eo(i.currentTask.id,e),onNext:eh,onPrevious:eb,canGoNext:i.queuedTasks.length>0,canGoPrevious:i.processedTasks.length>0},q)]}),i.queuedTasks.length>0&&(0,s.jsx)("div",{className:"mt-8 flex flex-col items-center",children:(0,s.jsxs)("div",{className:"w-full max-w-2xl p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:["Next in queue (",i.queuedTasks.length," remaining)"]}),(0,s.jsxs)("div",{className:"space-y-2",children:[i.queuedTasks.slice(0,10).map((e,t)=>(0,s.jsxs)("div",{className:"text-sm text-gray-600 truncate text-center",style:{opacity:t<5?1:1-(t-4)*.2},children:[t+1,". ",e.content]},e.id)),i.queuedTasks.length>10&&(0,s.jsxs)("div",{className:"text-sm text-gray-400 text-center",style:{opacity:.3},children:["+ ",i.queuedTasks.length-10," more..."]})]})]})})]}),E&&(0,s.jsx)(u,{onClose:()=>D(!1)}),i.currentTask&&(0,s.jsx)(h,{currentPriority:i.currentTask.priority,onPrioritySelect:ed,onClose:()=>U(!1),isVisible:V}),i.currentTask&&(0,s.jsx)(b,{projects:p,currentProjectId:i.currentTask.projectId,currentTask:i.currentTask,suggestions:ea,onProjectSelect:eu,onClose:()=>O(!1),isVisible:B},"project-overlay-".concat(i.currentTask.id)),i.currentTask&&(0,s.jsx)(f,{labels:N,currentTask:i.currentTask,onLabelsChange:eg,onClose:()=>G(!1),isVisible:Y}),i.currentTask&&(0,s.jsx)(k,{currentTask:i.currentTask,onScheduledDateChange:ef,onClose:()=>K(!1),isVisible:J}),i.currentTask&&(0,s.jsx)(j,{currentTask:i.currentTask,onDeadlineChange:ep,onClose:()=>Q(!1),isVisible:Z}),X&&i.currentTask&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:()=>$(!1),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Archive Task?"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"This will remove the task from your active list. You can still find it in your completed tasks."}),(0,s.jsxs)("p",{className:"text-sm font-medium text-gray-800 mb-6 p-3 bg-gray-50 rounded",children:['"',i.currentTask.content,'"']}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>$(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,s.jsx)("button",{onClick:ey,className:"flex-1 py-2 px-4 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors",children:"Archive"})]})]})}),ee&&i.currentTask&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:()=>et(!1),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Complete Task?"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Mark this task as completed. This action can be undone from your completed tasks."}),(0,s.jsxs)("p",{className:"text-sm font-medium text-gray-800 mb-6 p-3 bg-gray-50 rounded",children:['"',i.currentTask.content,'"']}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>et(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,s.jsx)("button",{onClick:ek,className:"flex-1 py-2 px-4 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Complete"})]})]})}),er&&(0,s.jsx)(w,{message:er.message,type:er.type,onClose:()=>es(null)})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[874,441,684,358],()=>t(6667)),_N_E=e.O()}]);