(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[893],{5238:(e,t,s)=>{Promise.resolve().then(s.bind(s,6593))},6593:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(5155),a=s(2115),i=s(6874),o=s.n(i);function n(e){let{project:t,nestingDepth:s=0,onDescriptionChange:i}=e,[o,n]=(0,a.useState)(t.description),[l,c]=(0,a.useState)(null),[d,h]=(0,a.useState)(!1),[x,m]=(0,a.useState)(null),p=(0,a.useRef)(null);(0,a.useEffect)(()=>{n(t.description)},[t.id,t.description]);let u=(0,a.useCallback)(e=>{l&&clearTimeout(l),c(setTimeout(()=>{e!==t.description&&i&&i(t.id,e)},1e3))},[l,t.description,t.id,i]),g=(0,a.useCallback)(async()=>{if(!d){h(!0),m(null);try{let e=await fetch("/api/projects/".concat(t.id,"/suggest-description"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentDescription:o})});if(!e.ok)throw Error("Failed to generate suggestion");let s=await e.json();n(s.suggestion),u(s.suggestion)}catch(e){console.error("Error generating suggestion:",e),m(e instanceof Error?e.message:"Failed to generate suggestion")}finally{h(!1)}}},[t.id,o,u,d]);(0,a.useEffect)(()=>{p.current&&(p.current.style.height="auto",p.current.style.height="".concat(p.current.scrollHeight,"px"))},[o]);let b={berry_red:"#b8256f",red:"#db4035",orange:"#ff9933",yellow:"#fad000",olive_green:"#afb83b",lime_green:"#7ecc49",green:"#299438",mint_green:"#6accbc",teal:"#158fad",sky_blue:"#14aaf5",light_blue:"#96c3eb",blue:"#4073ff",grape:"#884dff",violet:"#af38eb",lavender:"#eb96eb",magenta:"#e05194",salmon:"#ff8d85",charcoal:"#808080",grey:"#b8b8b8",taupe:"#ccac93"}[t.color]||"#299fe6",j=s>0,f=32*s;return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 transition-all hover:shadow-md ".concat(j?"border-l-4":""),style:{marginLeft:"".concat(f,"px"),...j?{borderLeftColor:b}:{}},children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[j&&(0,r.jsx)("div",{className:"flex items-center",children:Array.from({length:s},(e,t)=>(0,r.jsx)("div",{className:"w-0.5 h-4 bg-gray-300 mr-2",style:{backgroundColor:t===s-1?b:"#e5e7eb"}},t))}),(0,r.jsx)("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:b}}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 flex-1",children:t.name}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[s>0&&(0,r.jsxs)("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-purple-50 text-purple-700 border border-purple-200",children:["Level ",s]}),t.isInboxProject&&(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-md bg-blue-50 text-blue-700 border border-blue-200",children:"Inbox"})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Description"}),(0,r.jsx)("button",{onClick:g,disabled:d,className:"px-3 py-1 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md",children:d?"Generating...":"AI Suggest"})]}),(0,r.jsx)("textarea",{ref:p,value:o,onChange:e=>{let t=e.target.value;n(t),u(t)},className:"w-full p-3 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm leading-relaxed",placeholder:"Add a description for this project...",rows:3}),x&&(0,r.jsx)("p",{className:"mt-2 text-xs text-red-600",children:x}),(0,r.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:'Descriptions are stored as special tasks with "*" prefix and auto-save after 1 second.'})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 pt-3 border-t border-gray-100",children:[(0,r.jsx)("span",{children:t.isShared?"Shared Project":"Personal Project"}),(0,r.jsxs)("span",{children:["ID: ",t.id]})]})]})}function l(){let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)(!0),[l,c]=(0,a.useState)(null);(0,a.useEffect)(()=>{!async function(){try{i(!0),c(null);let e=await fetch("/api/projects/with-descriptions");if(!e.ok)throw Error("Failed to fetch projects");let s=await e.json();t(s)}catch(e){console.error("Error loading projects:",e),c(e instanceof Error?e.message:"Failed to load projects")}finally{i(!1)}}()},[]);let d=(0,a.useCallback)(async(e,s)=>{try{console.log("Updating project description:",{projectId:e,newDescription:s});let r=await fetch("/api/projects/".concat(e,"/description"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:s})});if(!r.ok){let e=await r.json();throw console.error("API Response error:",e),Error("Failed to update project description: ".concat(e.error||r.statusText))}t(t=>t.map(t=>t.id===e?{...t,description:s}:t)),console.log("Project description updated successfully")}catch(e){console.error("Error updating project description:",e),c(e instanceof Error?e.message:"Failed to update project description")}},[]),h=(e=>{let t=new Map(e.map(e=>[e.id,e])),s=[],r=new Set,a=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(!e.parentId||s.has(e.id))return 0;let r=t.get(e.parentId);return r?(s.add(e.id),1+a(r,s)):0},i=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r.has(t.id)||(s.push({...t,nestingDepth:a}),r.add(t.id),e.filter(e=>e.parentId===t.id).forEach(e=>i(e,a+1)))};return e.filter(e=>!e.parentId).forEach(e=>i(e,0)),e.filter(e=>!r.has(e.id)).forEach(e=>{let t=a(e);i(e,t)}),s})(e);return s?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-todoist-blue mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading projects..."})]})}):l?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-red-500 mb-4",children:(0,r.jsx)("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Projects"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:l}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-todoist-blue text-white rounded-md hover:bg-blue-600 transition-colors",children:"Retry"})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Project Management"}),(0,r.jsx)(o(),{href:"/",className:"px-3 py-1 text-sm bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 rounded-md transition-colors",children:"Task Processor"})]}),(0,r.jsx)("p",{className:"text-gray-600",children:"Manage your Todoist projects and their descriptions. Descriptions are stored as special tasks within each project for compatibility with other Todoist clients."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-todoist-blue",children:e.length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Total Projects"})]}),(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:e.filter(e=>e.description.trim()).length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"With Descriptions"})]}),(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:e.filter(e=>e.parentId).length}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Nested Projects"})]})]}),0===h.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"text-gray-400 mb-4",children:(0,r.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Projects Found"}),(0,r.jsx)("p",{className:"text-gray-600",children:"No projects are available at the moment."})]}):(0,r.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,r.jsx)(n,{project:e,nestingDepth:e.nestingDepth,onDescriptionChange:d},e.id))}),(0,r.jsxs)("div",{className:"mt-12 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"How Project Descriptions Work"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,r.jsx)("li",{children:"• Project descriptions are stored as special tasks within each project"}),(0,r.jsx)("li",{children:'• These tasks start with "*" and have the "project description" label'}),(0,r.jsx)("li",{children:"• They appear at the top of the project due to highest priority (P1)"}),(0,r.jsx)("li",{children:"• This approach ensures compatibility with all Todoist clients and LLM integrations"}),(0,r.jsx)("li",{children:"• Descriptions auto-save after 1 second of inactivity"})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[874,441,684,358],()=>t(5238)),_N_E=e.O()}]);